<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RobPac Resources - Premium Digital Resources</title>
  <meta name="description" content="Premium digital resources for entrepreneurs: courses, guides, templates, and more." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://payhip.com/payhip.js" type="text/javascript"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Cards: compact, no cropping */
    .product-card { cursor: pointer; transition: transform .18s, box-shadow .18s; }
    .product-card:hover { transform: translateY(-2px); box-shadow: 0 16px 22px -10px rgb(0 0 0 / 0.18); }
    .product-image-wrapper {
      background: #f9fafb;
      display: flex; align-items: center; justify-content: center;
      padding: .5rem;
      aspect-ratio: 1 / 1; /* supports 1:1 covers + book covers without crop */
    }
    .product-image { width: 100%; height: 100%; object-fit: contain; }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .popup-overlay { backdrop-filter: blur(4px); }
  </style>
</head>

<body class="bg-gray-50">
<!-- ROBPAC_RESOURCES_BUILD: CATS_FILTERS_SCALE_V1 -->

<header class="bg-white border-b border-gray-200 sticky top-0 z-40">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="logo.png" alt="RobPac Resources" class="h-14 w-14 sm:h-16 sm:w-16" />
        <div>
          <div class="text-xl font-extrabold text-gray-900 leading-tight">ROBPAC RESOURCES</div>
          <div class="text-xs text-gray-500 uppercase tracking-wide">Digital Products</div>
        </div>
      </div>

      <nav class="hidden md:flex items-center space-x-8">
        <a href="#home" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
        <a href="#catalog" class="text-gray-700 hover:text-blue-600 font-medium">Browse</a>
        <a href="#bundles" class="text-gray-700 hover:text-blue-600 font-medium">Bundles</a>
        <a href="#faq" class="text-gray-700 hover:text-blue-600 font-medium">FAQ</a>
        <a href="https://robpacpublishing.com" class="text-gray-700 hover:text-blue-600 font-medium">Main Site</a>
      </nav>

      <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg border border-gray-200 hover:bg-gray-50" type="button" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <div id="mobileMenu" class="md:hidden hidden mt-4 border-t border-gray-100 pt-4">
      <div class="flex flex-col gap-3">
        <a href="#home" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>
        <a href="#catalog" class="text-gray-700 hover:text-blue-600 font-medium">Browse</a>
        <a href="#bundles" class="text-gray-700 hover:text-blue-600 font-medium">Bundles</a>
        <a href="#faq" class="text-gray-700 hover:text-blue-600 font-medium">FAQ</a>
        <a href="https://robpacpublishing.com" class="text-gray-700 hover:text-blue-600 font-medium">Main Site</a>
      </div>
    </div>
  </div>
</header>

<section id="home" class="bg-gradient-to-b from-white to-gray-50 py-12 sm:py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-5 leading-tight">Premium Digital Resources<br/>for Entrepreneurs</h1>
    <p class="text-lg sm:text-xl text-gray-600 mb-8 max-w-3xl mx-auto">Courses, guides, templates, audio programs and more. Open any item to see details and checkout via Payhip.</p>
    <div class="flex flex-col sm:flex-row gap-3 justify-center">
      <a href="#catalog" class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition">Browse Catalog</a>
      <a href="#bundles" class="bg-white text-blue-600 border border-blue-200 font-semibold px-6 py-3 rounded-lg hover:bg-blue-50 transition">View Bundles</a>
    </div>
  </div>
</section>

<section class="py-10 bg-white border-t border-gray-100" id="categories">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-end justify-between gap-6 mb-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">Browse by Category</h2>
        <p class="text-gray-600 mt-1">Main categories (subcategories prepared for later).</p>
      </div>
      <a href="#catalog" class="text-blue-600 hover:text-blue-700 font-semibold text-sm">Go to catalog</a>
    </div>
    <div id="categoryCards" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4"></div>
  </div>
</section>

<section class="py-10 bg-gray-50 border-t border-gray-100" id="featured">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-end justify-between gap-6 mb-5">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">Featured Resources</h2>
        <p class="text-gray-600 mt-1">Compact picks across categories.</p>
      </div>
      <a href="#catalog" class="text-blue-600 hover:text-blue-700 font-semibold text-sm">Browse all</a>
    </div>
    <div id="featuredCarousel" class="flex gap-4 overflow-x-auto no-scrollbar pb-2"></div>
  </div>
</section>

<section class="py-14 bg-gradient-to-r from-blue-600 to-indigo-700" id="bundles">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center max-w-3xl mx-auto">
      <h2 class="text-3xl lg:text-4xl font-bold text-white mb-4">Bundles</h2>
      <p class="text-lg text-blue-100">Bundles will be expanded later. For now, browse the catalog by category and format.</p>
    </div>
  </div>
</section>

<section class="py-14" id="catalog">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-10">
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-3">Browse Our Catalog</h2>
      <p class="text-lg text-gray-600">Designed for hundreds of products: indexed search, debounced inputs, incremental rendering.</p>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6">
      <div class="grid gap-4 lg:grid-cols-12">
        <div class="lg:col-span-4">
          <label for="searchInput" class="text-sm font-semibold text-gray-900">Search</label>
          <input id="searchInput" type="text" class="mt-2 w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200" placeholder="Search title or description..." />
        </div>

        <div class="lg:col-span-4">
          <label for="categorySelect" class="text-sm font-semibold text-gray-900">Filter by Category</label>
          <select id="categorySelect" class="mt-2 w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">All Categories</option>
          </select>
          <div class="text-xs text-gray-500 mt-2">Subcategories are prepared in data and will be enabled later.</div>
        </div>

        <div class="lg:col-span-4">
          <label for="subcategorySelect" class="text-sm font-semibold text-gray-900">Subcategory (prepared)</label>
          <select id="subcategorySelect" class="mt-2 w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200" disabled>
            <option value="">All Subcategories</option>
          </select>
        </div>
      </div>

      <div class="mt-4 grid gap-4 lg:grid-cols-12">
        <div class="lg:col-span-10">
          <div class="text-sm font-semibold text-gray-900 mb-2">Filter by Format</div>
          <div id="formatChips" class="flex flex-wrap gap-2"></div>
        </div>
        <div class="lg:col-span-2 flex items-end justify-end">
          <button id="clearFiltersBtn" class="text-sm font-semibold text-blue-600 hover:text-blue-700">Clear</button>
        </div>
      </div>

      <div class="mt-5 flex items-center justify-between gap-4">
        <div class="text-sm text-gray-600"><span id="resultsCount" class="font-semibold text-gray-900">0</span> results</div>
        <button id="loadMoreBtn" class="hidden bg-white text-blue-600 border border-blue-200 font-semibold px-4 py-2 rounded-lg hover:bg-blue-50 transition text-sm" type="button">Load more</button>
      </div>

      <div id="productsGrid" class="mt-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
    </div>
  </div>
</section>

<section class="py-14 bg-white" id="faq">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-gray-900 mb-3">FAQ</h2>
      <p class="text-gray-600">Payhip handles checkout and provides instant delivery.</p>
    </div>

    <div class="max-w-3xl mx-auto space-y-4">
      <details class="bg-gray-50 rounded-xl p-5 border border-gray-200">
        <summary class="cursor-pointer font-semibold text-gray-900">How do I access my purchase?</summary>
        <div class="mt-3 text-gray-700 text-sm leading-relaxed">After checkout, Payhip provides an instant download link and a confirmation email.</div>
      </details>

      <details class="bg-gray-50 rounded-xl p-5 border border-gray-200">
        <summary class="cursor-pointer font-semibold text-gray-900">Do products include commercial use?</summary>
        <div class="mt-3 text-gray-700 text-sm leading-relaxed">If included, you can use resources in your business. Always follow the licensing terms included with each item.</div>
      </details>
    </div>
  </div>
</section>

<!-- Product Detail Modal -->
<div id="productModal" class="hidden fixed inset-0 z-50 bg-black/40 popup-overlay flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full relative">
    <button type="button" onclick="closeProductModal()" class="absolute top-3 right-3 p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-50" aria-label="Close">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
    <div id="productModalContent" class="p-4 sm:p-5 max-h-[70vh] overflow-y-auto"></div>
  </div>
</div>

<footer class="bg-gray-900 text-gray-300 py-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
      <div class="text-sm">© 2025 RobPac Resources · <a class="text-blue-400 hover:text-blue-300" href="https://robpacpublishing.com">RobPac Publishing</a></div>
      <div class="text-sm"><a class="hover:text-white" href="mailto:robpacpublishing@gmail.com">robpacpublishing@gmail.com</a></div>
    </div>
  </div>
</footer>

<script>
  // ---------------------------------------
  // DATA
  // ---------------------------------------
  // Categories + subcategories (prepared; subcategory filter disabled by default).
  var CATEGORIES = [
    { name: "Marketing", subcategories: [] },
    { name: "Sales & Conversion", subcategories: [] },
    { name: "Business & Growth", subcategories: [] },
    { name: "Creator & Media", subcategories: [] },
    { name: "Productivity & Systems", subcategories: [] },
    { name: "Mindset & Personal Growth", subcategories: [] },
    { name: "Career & Freelancing", subcategories: [] },
    { name: "Health & Wellness", subcategories: [] },
    { name: "Technology & Security", subcategories: [] },
    { name: "Special Topics", subcategories: [] }
  ];

  // Formats (from your UI list).
  var FORMAT_OPTIONS = [
    "Book",
    "Video",
    "Listicle",
    "Checklist",
    "Notion Template",
    "Mini-Course",
    "Guide",
    "Audio",
    "Prompt Pack",
    "Template",
    "Toolstack",
    "Workbook"
  ];

  // Products: admin_generator.html can inject a large array by defining window.__ROBPAC_PRODUCTS__ before this script.
  // Required fields: id, title, mainCategory, format, description, price. Optional: subCategory, compareAt, payhipId, cover, info.
  var PRODUCTS = (window.__ROBPAC_PRODUCTS__ && Array.isArray(window.__ROBPAC_PRODUCTS__)) ? window.__ROBPAC_PRODUCTS__ : [
    {
      id: "p-content-multiplier",
      title: "Content Multiplier - Prompt Pack",
      mainCategory: "Creator & Media",
      subCategory: "",
      format: "Prompt Pack",
      description: "Turn one idea into multiple outputs with ready-to-use prompts.",
      info: "Prompt Pack",
      price: 15,
      compareAt: 25,
      payhipId: "rQWRZ",
      cover: "covers/content-multiplier.png"
    },
    {
      id: "p-launch-checklist",
      title: "Product Launch Checklist",
      mainCategory: "Special Topics",
      subCategory: "",
      format: "Checklist",
      description: "Step-by-step launch plan to avoid missed details.",
      info: "Printable PDF",
      price: 7,
      compareAt: 12,
      payhipId: "",
      cover: "covers/product-launch-checklist.png"
    },
    {
      id: "p-youtube-starter",
      title: "YouTube Starter System",
      mainCategory: "Creator & Media",
      subCategory: "",
      format: "Guide",
      description: "A simple workflow to plan, publish, and iterate consistently.",
      info: "PDF + templates",
      price: 27,
      compareAt: 37,
      payhipId: "",
      cover: "covers/youtube-starter-system.png"
    }
  ];

  // Featured: keep small; for large catalogs you can set this list from admin.
  var FEATURED_IDS = (window.__ROBPAC_FEATURED__ && Array.isArray(window.__ROBPAC_FEATURED__)) ? window.__ROBPAC_FEATURED__ : [
    "p-content-multiplier",
    "p-youtube-starter"
  ];

  // ---------------------------------------
  // PERF: precomputed search index
  // ---------------------------------------
  function normalize(str) { return String(str || "").toLowerCase().trim(); }

  function buildSearchIndex() {
    for (var i = 0; i < PRODUCTS.length; i++) {
      var p = PRODUCTS[i] || {};
      p.__search = normalize([p.title, p.description, p.mainCategory, p.subCategory, p.format, p.info].join(" "));
    }
  }

  // ---------------------------------------
  // Utilities
  // ---------------------------------------
  function escapeHtml(str) {
    return String(str || "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  function formatMoney(n) {
    var v = Number(n);
    if (!isFinite(v)) return "";
    return "$" + v.toFixed(0);
  }

  function initPayhipButtons() {
    try {
      if (window.Payhip && window.Payhip.Button && typeof window.Payhip.Button.init === "function") {
        window.Payhip.Button.init();
      }
    } catch (e) {}
  }

  function buildPayhipButton(payhipId, label, extraClasses) {
    if (!payhipId) return "";
    var cls = "payhip-buy-button inline-flex items-center justify-center w-full bg-blue-600 text-white font-semibold py-2.5 rounded-lg hover:bg-blue-700 transition text-sm " + (extraClasses || "");
    return '<a class="' + cls + '" data-product="' + escapeHtml(payhipId) + '" data-theme="blue" href="https://payhip.com/b/' + escapeHtml(payhipId) + '">' + escapeHtml(label || "Buy Now") + '</a>';
  }

  // ---------------------------------------
  // Modal
  // ---------------------------------------
  function openProductModalById(productId) {
    for (var i = 0; i < PRODUCTS.length; i++) {
      if (PRODUCTS[i] && PRODUCTS[i].id === productId) {
        openProductModal(PRODUCTS[i]);
        return;
      }
    }
  }

  function openProductModal(product) {
    var modal = document.getElementById("productModal");
    var content = document.getElementById("productModalContent");
    if (!modal || !content || !product) return;

    var catLine = product.mainCategory ? (product.mainCategory + (product.subCategory ? " • " + product.subCategory : "")) : "";
    var buyHtml = product.payhipId ? buildPayhipButton(product.payhipId, "Buy Now", "") : '<div class="text-sm text-gray-500">This item is not yet available for purchase.</div>';

    content.innerHTML =
      '<div class="grid sm:grid-cols-[140px,1fr] gap-4 items-start">' +
        '<div class="bg-gray-50 border border-gray-200 rounded-xl p-3 flex items-center justify-center aspect-[4/5]">' +
          (product.cover ? '<img src="' + escapeHtml(product.cover) + '" alt="' + escapeHtml(product.title) + '" class="w-full h-full object-contain" loading="lazy" />' : '') +
        '</div>' +
        '<div>' +
          (product.format ? '<div class="text-xs font-semibold text-blue-700 mb-2">' + escapeHtml(product.format) + '</div>' : '') +
          '<div class="text-lg font-bold text-gray-900 leading-snug">' + escapeHtml(product.title) + '</div>' +
          (catLine ? '<div class="text-sm text-gray-500 mt-1">' + escapeHtml(catLine) + '</div>' : '') +
          (product.description ? '<div class="text-sm text-gray-700 mt-3 leading-relaxed">' + escapeHtml(product.description) + '</div>' : '') +
          (product.info ? '<div class="text-xs text-gray-500 mt-2">' + escapeHtml(product.info) + '</div>' : '') +
          '<div class="mt-4 flex items-baseline gap-2">' +
            '<div class="text-2xl font-extrabold text-gray-900">' + escapeHtml(formatMoney(product.price)) + '</div>' +
            (product.compareAt ? '<div class="text-sm text-gray-500 line-through">' + escapeHtml(formatMoney(product.compareAt)) + '</div>' : '') +
          '</div>' +
          '<div class="mt-4">' + buyHtml + '</div>' +
        '</div>' +
      '</div>';

    modal.classList.remove("hidden");
    initPayhipButtons();
  }

  function closeProductModal() {
    var modal = document.getElementById("productModal");
    if (!modal) return;
    modal.classList.add("hidden");
  }

  // ---------------------------------------
  // Rendering (home + filters + catalog)
  // ---------------------------------------
  function renderCategoryCards() {
    var el = document.getElementById("categoryCards");
    if (!el) return;
    el.innerHTML = "";

    for (var i = 0; i < CATEGORIES.length; i++) {
      var c = CATEGORIES[i];
      var btn = document.createElement("button");
      btn.type = "button";
      btn.className = "text-left bg-white border border-gray-200 rounded-xl px-4 py-3 hover:border-blue-200 hover:shadow-sm transition";
      btn.setAttribute("data-category", c.name);
      btn.innerHTML =
        '<div class="text-xs font-semibold text-gray-500">CATEGORY</div>' +
        '<div class="mt-1 font-bold text-gray-900">' + escapeHtml(c.name) + '</div>';
      btn.addEventListener("click", (function(name) {
        return function() { setCategoryFilter(name); };
      })(c.name));
      el.appendChild(btn);
    }
  }

  function renderCategorySelect() {
    var sel = document.getElementById("categorySelect");
    if (!sel) return;

    var current = sel.value || "";
    var html = '<option value="">All Categories</option>';
    for (var i = 0; i < CATEGORIES.length; i++) {
      html += '<option value="' + escapeHtml(CATEGORIES[i].name) + '">' + escapeHtml(CATEGORIES[i].name) + '</option>';
    }
    sel.innerHTML = html;
    sel.value = current;
  }

  function renderSubcategorySelect() {
    var sel = document.getElementById("subcategorySelect");
    if (!sel) return;

    // prepared only: enabled later when subcategories are populated
    if (!STATE.category) {
      sel.disabled = true;
      sel.innerHTML = '<option value="">All Subcategories</option>';
      return;
    }

    var c = null;
    for (var i = 0; i < CATEGORIES.length; i++) {
      if (CATEGORIES[i].name === STATE.category) { c = CATEGORIES[i]; break; }
    }

    var subs = (c && Array.isArray(c.subcategories)) ? c.subcategories : [];
    if (!subs.length) {
      sel.disabled = true;
      sel.innerHTML = '<option value="">All Subcategories</option>';
      return;
    }

    sel.disabled = false;
    var current = sel.value || "";
    var opt = '<option value="">All Subcategories</option>';
    for (var j = 0; j < subs.length; j++) {
      opt += '<option value="' + escapeHtml(subs[j]) + '">' + escapeHtml(subs[j]) + '</option>';
    }
    sel.innerHTML = opt;
    sel.value = current;
  }

  function renderFormatChips() {
    var el = document.getElementById("formatChips");
    if (!el) return;

    var html = '';
    html += makeChip("all", "All");
    for (var i = 0; i < FORMAT_OPTIONS.length; i++) {
      html += makeChip(FORMAT_OPTIONS[i], FORMAT_OPTIONS[i]);
    }
    el.innerHTML = html;

    var btns = el.querySelectorAll("[data-format]");
    for (var k = 0; k < btns.length; k++) {
      btns[k].addEventListener("click", function() {
        var f = this.getAttribute("data-format");
        if (!f) return;

        if (f === "all") {
          STATE.formats = new Set(["all"]);
        } else {
          if (STATE.formats.has("all")) STATE.formats.delete("all");
          if (STATE.formats.has(f)) STATE.formats.delete(f);
          else STATE.formats.add(f);
          if (STATE.formats.size === 0) STATE.formats.add("all");
        }

        updateChipUI();
        STATE.limit = 24;
        renderCatalog();
      });
    }

    updateChipUI();
  }

  function makeChip(value, label) {
    return '<button type="button" data-format="' + escapeHtml(value) + '" class="px-3 py-1.5 rounded-full border text-xs font-semibold transition"></button>';
  }

  function updateChipUI() {
    var el = document.getElementById("formatChips");
    if (!el) return;

    var btns = el.querySelectorAll("[data-format]");
    for (var i = 0; i < btns.length; i++) {
      var f = btns[i].getAttribute("data-format");
      var active = STATE.formats.has(f);

      btns[i].textContent = (f === "all") ? "All" : f;
      btns[i].className = "px-3 py-1.5 rounded-full border text-xs font-semibold transition " +
        (active ? "bg-blue-600 text-white border-blue-600" : "bg-white text-gray-700 border-gray-200 hover:bg-gray-50");
    }
  }

  function renderFeaturedCarousel() {
    var el = document.getElementById("featuredCarousel");
    if (!el) return;
    el.innerHTML = "";

    for (var i = 0; i < FEATURED_IDS.length; i++) {
      var id = FEATURED_IDS[i];
      var p = null;
      for (var j = 0; j < PRODUCTS.length; j++) {
        if (PRODUCTS[j] && PRODUCTS[j].id === id) { p = PRODUCTS[j]; break; }
      }
      if (!p) continue;

      var card = document.createElement("div");
      card.className = "product-card min-w-[210px] max-w-[210px] bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden";
      card.innerHTML =
        '<div class="product-image-wrapper">' +
          (p.cover ? '<img src="' + escapeHtml(p.cover) + '" alt="' + escapeHtml(p.title) + '" class="product-image" loading="lazy" />' : '') +
        '</div>' +
        '<div class="p-3">' +
          (p.format ? '<div class="text-xs font-semibold text-gray-500 mb-1">' + escapeHtml(p.format) + '</div>' : '') +
          '<div class="text-sm font-bold text-gray-900 line-clamp-2">' + escapeHtml(p.title) + '</div>' +
          '<div class="mt-2 flex items-baseline gap-2">' +
            '<div class="text-base font-extrabold text-gray-900">' + escapeHtml(formatMoney(p.price)) + '</div>' +
            (p.compareAt ? '<div class="text-xs text-gray-500 line-through">' + escapeHtml(formatMoney(p.compareAt)) + '</div>' : '') +
          '</div>' +
          '<div class="mt-2 text-xs text-gray-500 line-clamp-1">' + escapeHtml(p.mainCategory || "") + '</div>' +
        '</div>';

      card.addEventListener("click", (function(prod) {
        return function(e) {
          if (e.target.closest("a") || e.target.closest("button")) return;
          openProductModal(prod);
        };
      })(p));

      el.appendChild(card);
    }
  }

  // ---------------------------------------
  // Catalog state + filtering (fast)
  // ---------------------------------------
  var STATE = {
    q: "",
    category: "",
    subcategory: "",
    formats: new Set(["all"]),
    limit: 24
  };

  function getActiveFormats() {
    if (STATE.formats.has("all")) return null;
    return Array.from(STATE.formats);
  }

  function filterProducts() {
    var q = normalize(STATE.q);
    var formats = getActiveFormats();
    var cat = STATE.category;
    var sub = STATE.subcategory;

    var out = [];
    for (var i = 0; i < PRODUCTS.length; i++) {
      var p = PRODUCTS[i];
      if (!p) continue;

      if (cat && p.mainCategory !== cat) continue;
      if (sub && p.subCategory !== sub) continue;

      if (formats && formats.length) {
        var ok = false;
        for (var j = 0; j < formats.length; j++) {
          if (p.format === formats[j]) { ok = true; break; }
        }
        if (!ok) continue;
      }

      if (q && (!p.__search || p.__search.indexOf(q) === -1)) continue;

      out.push(p);
    }
    return out;
  }

  function renderCatalog() {
    var grid = document.getElementById("productsGrid");
    var countEl = document.getElementById("resultsCount");
    var loadMoreBtn = document.getElementById("loadMoreBtn");
    if (!grid || !countEl || !loadMoreBtn) return;

    var filtered = filterProducts();
    countEl.textContent = String(filtered.length);

    grid.innerHTML = "";
    var frag = document.createDocumentFragment();

    var shown = filtered.slice(0, STATE.limit);
    for (var i = 0; i < shown.length; i++) {
      var p = shown[i];

      var card = document.createElement("div");
      card.className = "product-card bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden";
      card.innerHTML =
        '<div class="product-image-wrapper">' +
          (p.cover ? '<img src="' + escapeHtml(p.cover) + '" alt="' + escapeHtml(p.title) + '" class="product-image" loading="lazy" />' : '') +
        '</div>' +
        '<div class="p-3">' +
          (p.format ? '<div class="text-xs font-semibold text-gray-500 mb-1">' + escapeHtml(p.format) + '</div>' : '') +
          '<div class="text-sm font-bold text-gray-900 line-clamp-2">' + escapeHtml(p.title) + '</div>' +
          (p.description ? '<div class="mt-1 text-xs text-gray-600 line-clamp-2">' + escapeHtml(p.description) + '</div>' : '') +
          '<div class="mt-3 flex items-baseline gap-2">' +
            '<div class="text-lg font-extrabold text-gray-900">' + escapeHtml(formatMoney(p.price)) + '</div>' +
            (p.compareAt ? '<div class="text-xs text-gray-500 line-through">' + escapeHtml(formatMoney(p.compareAt)) + '</div>' : '') +
          '</div>' +
          '<div class="mt-1 text-xs text-gray-500 line-clamp-1">' + escapeHtml(p.mainCategory || "") + (p.subCategory ? ' • ' + escapeHtml(p.subCategory) : '') + '</div>' +
        '</div>';

      card.addEventListener("click", (function(prod) {
        return function(e) {
          if (e.target.closest("a") || e.target.closest("button")) return;
          openProductModal(prod);
        };
      })(p));

      frag.appendChild(card);
    }

    grid.appendChild(frag);
    loadMoreBtn.classList.toggle("hidden", filtered.length <= STATE.limit);
  }

  function setCategoryFilter(catName) {
    STATE.category = catName || "";
    STATE.subcategory = "";
    STATE.limit = 24;

    var sel = document.getElementById("categorySelect");
    if (sel) sel.value = STATE.category;

    renderSubcategorySelect();
    renderCatalog();

    var target = document.getElementById("catalog");
    if (target) target.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  function clearFilters() {
    STATE.q = "";
    STATE.category = "";
    STATE.subcategory = "";
    STATE.formats = new Set(["all"]);
    STATE.limit = 24;

    var search = document.getElementById("searchInput");
    if (search) search.value = "";

    var cat = document.getElementById("categorySelect");
    if (cat) cat.value = "";

    var sub = document.getElementById("subcategorySelect");
    if (sub) {
      sub.value = "";
      sub.disabled = true;
      sub.innerHTML = '<option value="">All Subcategories</option>';
    }

    updateChipUI();
    renderCatalog();
  }

  function debounce(fn, delay) {
    var t = null;
    return function() {
      var args = arguments;
      clearTimeout(t);
      t = setTimeout(function() { fn.apply(null, args); }, delay);
    };
  }

  // ---------------------------------------
  // Init
  // ---------------------------------------
  document.addEventListener("DOMContentLoaded", function() {
    var mb = document.getElementById("mobileMenuBtn");
    var mm = document.getElementById("mobileMenu");
    if (mb && mm) {
      mb.addEventListener("click", function() { mm.classList.toggle("hidden"); });
    }

    document.addEventListener("click", function(e) {
      var modal = document.getElementById("productModal");
      if (!modal || modal.classList.contains("hidden")) return;
      if (e.target === modal) closeProductModal();
    });
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") closeProductModal();
    });

    buildSearchIndex();
    renderCategoryCards();
    renderCategorySelect();
    renderSubcategorySelect();
    renderFormatChips();
    renderFeaturedCarousel();
    renderCatalog();

    var search = document.getElementById("searchInput");
    if (search) {
      search.addEventListener("input", debounce(function() {
        STATE.q = search.value || "";
        STATE.limit = 24;
        renderCatalog();
      }, 120));
    }

    var cat = document.getElementById("categorySelect");
    if (cat) {
      cat.addEventListener("change", function() {
        STATE.category = cat.value || "";
        STATE.subcategory = "";
        STATE.limit = 24;
        renderSubcategorySelect();
        renderCatalog();
      });
    }

    var sub = document.getElementById("subcategorySelect");
    if (sub) {
      sub.addEventListener("change", function() {
        STATE.subcategory = sub.value || "";
        STATE.limit = 24;
        renderCatalog();
      });
    }

    var clearBtn = document.getElementById("clearFiltersBtn");
    if (clearBtn) clearBtn.addEventListener("click", function() { clearFilters(); });

    var loadMoreBtn = document.getElementById("loadMoreBtn");
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener("click", function() {
        STATE.limit += 24;
        renderCatalog();
      });
    }

    initPayhipButtons();
  });
</script>
</body>
</html>
